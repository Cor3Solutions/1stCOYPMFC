<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>1st COY - PMFC Batangas</title>
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <meta content="" name="keywords">
    <meta content="" name="description">

    <!-- Favicon -->
    <link href="logo.jpg" rel="icon">

    <!-- Google Web Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;500;600&family=Rubik:wght@500;600;700&display=swap"
        rel="stylesheet">

    <!-- Icon Font Stylesheet -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.10.0/css/all.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.4.1/font/bootstrap-icons.css" rel="stylesheet">

    <!-- Libraries Stylesheet -->
    <link href="lib/animate/animate.min.css" rel="stylesheet">
    <link href="lib/owlcarousel/assets/owl.carousel.min.css" rel="stylesheet">

    <!-- Customized Bootstrap Stylesheet -->
    <link href="css/bootstrap.min.css" rel="stylesheet">

    <!-- Template Stylesheet -->
    <link href="css/style.css" rel="stylesheet">
</head>

<body>
    <div id="header"></div>

    <!-- Page Header Start -->
    <div class="container-fluid page-header py-5 mb-5 wow fadeIn" data-wow-delay="0.1s"
        style="position: relative; background: url('img/cover.png') center center/cover no-repeat;">

        <!-- Gradient Overlay -->
        <div style="position: absolute; inset: 0; 
        background: linear-gradient(to right, rgba(117, 53, 53, 0.85), rgba(93, 92, 92, 0.6)); 
        z-index: 1;">
        </div>

        <div class="container py-5 position-relative" style="z-index: 2;">
            <h1 class="display-3 text-white animated slideInRight">Police Community Relations</h1>
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb animated slideInRight mb-0">
                    <li class="breadcrumb-item"><a href="index.html" class="text-white">Home</a></li>
                    <li class="breadcrumb-item active text-white" aria-current="page">PCR</li>
                </ol>
            </nav>
        </div>
    </div>
    <!-- Page Header End -->

    <div class="container-xxl py-5">
        <div class="container">
            <div class="text-center wow fadeIn" data-wow-delay="0.1s">
                <p class="fw-medium text-uppercase text-primary mb-2">After Activity Report</p>
                <h1 class="display-5 mb-5"> Retooled Community Support</h1>
            </div>

            <div class="row mb-4">
                <div class="row g-2 align-items-center">
                    <!-- Search -->
                    <div class="col-md-6">
                        <input type="text" id="searchPCR" class="form-control" placeholder="Search activities...">
                    </div>

                    <div class="col-6 col-sm-6 col-md-2 mb-2">
                        <input type="date" id="startDate" class="form-control" placeholder="Start Date">
                    </div>

                    <div class="col-6 col-sm-6 col-md-2 mb-2">
                        <input type="date" id="endDate" class="form-control" placeholder="End Date">
                    </div>

                    <!-- Sort Button -->
                    <div class="col-md-2">
                        <button id="sortBtn" class="btn btn-outline-primary w-100" data-sort="latest">
                            <i class="fas fa-sort-amount-down me-2"></i>Sort by Latest
                        </button>
                    </div>
                </div>


                <div class="row g-4" id="pcrActivities">
                    <div class="col-md-6 col-lg-4 pcr-item" data-date="2025-09-05"
                        data-title="Program at Barangay Antipolo Rosario Batangas">
                        <div class="card shadow h-100 border-0">
                            <img src="img/activities/1.png" class="card-img-top" alt="Barangay Antipolo">
                            <div class="card-body d-flex flex-column">
                                <h5 class="card-title">Program at Barangay Antipolo</h5>
                                <p class="card-text text-muted">Rosario, Batangas — September 5, 2025</p>
                                <p class="card-text text-muted">Personnel of 1st Batangas PMFC and 59th Infantry
                                    (Protector)
                                    Battalion, Philippine Army, offered free haircuts during the RCSP activity.</p>

                                <div class="mt-auto">
                                    <button class="btn btn-download w-100 download-btn" data-file="1.pdf">
                                        <i class="fa fa-download me-2"></i>Download
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-6 col-lg-4 pcr-item" data-date="2025-08-05"
                        data-title="Program at Barangay Apar Lobo Batangas">
                        <div class="card shadow h-100 border-0">
                            <img src="img/activities/2.png" class="card-img-top" alt="Barangay Apar">
                            <div class="card-body d-flex flex-column">
                                <h5 class="card-title">Program at Barangay Apar</h5>
                                <p class="card-text text-muted">Lobo, Batangas — August 5, 2025</p>
                                <p class="card-text text-muted">The Provincial Health Office and other NGAs provided
                                    medical
                                    and dental services during the RCSP activity.</p>

                                <div class="mt-auto">
                                    <button class="btn btn-download w-100 download-btn" data-file="2.pdf">
                                        <i class="fa fa-download me-2"></i>Download
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-6 col-lg-4 pcr-item" data-date="2025-07-16"
                        data-title="Program at Barangay Bacao Taysan Batangas">
                        <div class="card shadow h-100 border-0">
                            <img src="img/activities/3.png" class="card-img-top" alt="Barangay Bacao">
                            <div class="card-body d-flex flex-column">
                                <h5 class="card-title">Program at Barangay Bacao</h5>
                                <p class="card-text text-muted">Taysan, Batangas — July 16, 2025</p>
                                <p class="card-text text-muted">The Provincial Agriculture Office distributed
                                    food-bearing
                                    seedlings and fertilizers to residents during the RCSP activity.</p>

                                <div class="mt-auto">
                                    <button class="btn btn-download w-100 download-btn" data-file="3.pdf">
                                        <i class="fa fa-download me-2"></i>Download
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-6 col-lg-4 pcr-item" data-date="2025-09-11"
                        data-title="Program at Barangay Banalo Rosario Batangas">
                        <div class="card shadow h-100 border-0">
                            <img src="img/activities/4.png" class="card-img-top" alt="Barangay Banalo">
                            <div class="card-body d-flex flex-column">
                                <h5 class="card-title">Program at Barangay Banalo</h5>
                                <p class="card-text text-muted">Rosario, Batangas — September 11, 2025</p>
                                <p class="card-text text-muted">The 1st Batangas PMFC and 59th Infantry (Protector)
                                    Battalion, Philippine Army, offered free haircuts during the RCSP activity.</p>
                                <div class="mt-auto">
                                    <button class="btn btn-download w-100 download-btn" data-file="4.pdf">
                                        <i class="fa fa-download me-2"></i>Download
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-6 col-lg-4 pcr-item" data-date="2025-07-05"
                        data-title="Program at Barangay Buhay na Sapa San Juan Batangas">
                        <div class="card shadow h-100 border-0">
                            <img src="img/activities/5.png" class="card-img-top" alt="Barangay Buhay na Sapa">
                            <div class="card-body d-flex flex-column">
                                <h5 class="card-title">Program at Barangay Buhay na Sapa</h5>
                                <p class="card-text text-muted">San Juan, Batangas — July 5, 2025</p>
                                <p class="card-text text-muted">Representatives from each NGA delivered messages of
                                    support
                                    during the RCSP activity.</p>
                                <div class="mt-auto">
                                    <button class="btn btn-download w-100 download-btn" data-file="5.pdf">
                                        <i class="fa fa-download me-2"></i>Download
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-6 col-lg-4 pcr-item" data-date="2025-07-12"
                        data-title="Program at Barangay Bulsa San Juan Batangas">
                        <div class="card shadow h-100 border-0">
                            <img src="img/activities/6.png" class="card-img-top" alt="Barangay Bulsa">
                            <div class="card-body d-flex flex-column">
                                <h5 class="card-title">Program at Barangay Bulsa</h5>
                                <p class="card-text text-muted">San Juan, Batangas — July 12, 2025</p>
                                <p class="card-text text-muted">The Provincial Agriculture Office distributed
                                    food-bearing
                                    seedlings and fertilizers during the RCSP activity.</p>
                                <div class="mt-auto">
                                    <button class="btn btn-download w-100 download-btn" data-file="6.pdf">
                                        <i class="fa fa-download me-2"></i>Download
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-6 col-lg-4 pcr-item" data-date="2025-07-19"
                        data-title="Program at Barangay Escribano San Juan Batangas">
                        <div class="card shadow h-100 border-0">
                            <img src="img/activities/7.png" class="card-img-top" alt="Barangay Escribano">
                            <div class="card-body d-flex flex-column">
                                <h5 class="card-title">Program at Barangay Escribano</h5>
                                <p class="card-text text-muted">San Juan, Batangas — July 19, 2025</p>
                                <p class="card-text text-muted">The Provincial Agriculture Office and Provincial
                                    Veterinary
                                    Office distributed food-bearing seedlings, fertilizers, poultry and hog vitamins,
                                    and
                                    disinfectants during the RCSP activity.</p>
                                <div class="mt-auto">
                                    <button class="btn btn-download w-100 download-btn" data-file="7.pdf">
                                        <i class="fa fa-download me-2"></i>Download
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-6 col-lg-4 pcr-item" data-date="2025-08-13"
                        data-title="Program at Barangay Jaybanga Lobo Batangas">
                        <div class="card shadow h-100 border-0">
                            <img src="img/activities/8.png" class="card-img-top" alt="Barangay Jaybanga">
                            <div class="card-body d-flex flex-column">
                                <h5 class="card-title">Program at Barangay Jaybanga</h5>
                                <p class="card-text text-muted">Lobo, Batangas — August 13, 2025</p>
                                <p class="card-text text-muted">The Provincial Health Office provided medical and dental
                                    services during the RCSP activity.</p>
                                <div class="mt-auto">
                                    <button class="btn btn-download w-100 download-btn" data-file="8.pdf">
                                        <i class="fa fa-download me-2"></i>Download
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-6 col-lg-4 pcr-item" data-date="2025-08-04"
                        data-title="Program at Barangay Laiya Ibabao San Juan Batangas">
                        <div class="card shadow h-100 border-0">
                            <img src="img/activities/9.png" class="card-img-top" alt="Barangay Laiya Ibabao">
                            <div class="card-body d-flex flex-column">
                                <h5 class="card-title">Program at Barangay Laiya Ibabao</h5>
                                <p class="card-text text-muted">San Juan, Batangas — August 4, 2025</p>
                                <p class="card-text text-muted">The Provincial Health Office and other NGAs provided
                                    medical
                                    and dental services during the RCSP activity.</p>
                                <div class="mt-auto">
                                    <button class="btn btn-download w-100 download-btn" data-file="9.pdf">
                                        <i class="fa fa-download me-2"></i></i>Download
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-6 col-lg-4 pcr-item" data-date="2025-08-04"
                        data-title="Program at Barangay Libato San Juan Batangas">
                        <div class="card shadow h-100 border-0">
                            <img src="img/activities/10.png" class="card-img-top" alt="Barangay Libato">
                            <div class="card-body d-flex flex-column">
                                <h5 class="card-title">Program at Barangay Libato</h5>
                                <p class="card-text text-muted">San Juan, Batangas — August 4, 2025</p>
                                <p class="card-text text-muted">The Provincial Health Office and other NGAs provided
                                    medical
                                    and dental services during the RCSP activity.</p>

                                <div class="mt-auto">
                                    <button class="btn btn-download w-100 download-btn" data-file="10.pdf">
                                        <i class="fa fa-download me-2"></i>Download
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-6 col-lg-4 pcr-item" data-date="2025-08-13"
                        data-title="Program at Barangay Macalamcam A Lobo Batangas">
                        <div class="card shadow h-100 border-0">
                            <img src="img/activities/11.png" class="card-img-top" alt="Barangay Macalamcam A">
                            <div class="card-body d-flex flex-column">
                                <h5 class="card-title">Program at Barangay Macalamcam A</h5>
                                <p class="card-text text-muted">Lobo, Batangas — August 13, 2025</p>
                                <p class="card-text text-muted">The Provincial Health Office and other NGAs provided
                                    medical
                                    and dental services during the RCSP activity.</p>
                                <div class="mt-auto">
                                    <button class="btn btn-download w-100 download-btn" data-file="11.pdf">
                                        <i class="fa fa-download me-2"></i>Download
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-6 col-lg-4 pcr-item" data-date="2025-08-15"
                        data-title="Program at Barangay Malalim na Sanog Lobo Batangas">
                        <div class="card shadow h-100 border-0">
                            <img src="img/activities/12.png" class="card-img-top" alt="Barangay Malalim na Sanog">
                            <div class="card-body d-flex flex-column">
                                <h5 class="card-title">Program at Barangay Malalim na Sanog</h5>
                                <p class="card-text text-muted">Lobo, Batangas — August 15, 2025</p>
                                <p class="card-text text-muted">The 1st Batangas PMFC and 59th Infantry (Protector)
                                    Battalion, Philippine Army, offered free haircuts during the RCSP activity.</p>
                                <div class="mt-auto">
                                    <button class="btn btn-download w-100 download-btn" data-file="12.pdf">
                                        <i class="fa fa-download me-2"></i>Download
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-6 col-lg-4 pcr-item" data-date="2025-08-03"
                        data-title="Program at Barangay Matamis Rosario Batangas">
                        <div class="card shadow h-100 border-0">
                            <img src="img/activities/13.png" class="card-img-top" alt="Barangay Matamis">
                            <div class="card-body d-flex flex-column">
                                <h5 class="card-title">Program at Barangay Matamis</h5>
                                <p class="card-text text-muted">Rosario, Batangas — August 3, 2025</p>
                                <p class="card-text text-muted">The Provincial Health Office provided medical and dental
                                    services during the RCSP activity.</p>
                                <div class="mt-auto">
                                    <button class="btn btn-download w-100 download-btn" data-file="13.pdf">
                                        <i class="fa fa-download me-2"></i>Download
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-6 col-lg-4 pcr-item" data-date="2025-08-08"
                        data-title="Program at Barangay Nasi Rosario Batangas">
                        <div class="card shadow h-100 border-0">
                            <img src="img/activities/14.png" class="card-img-top" alt="Barangay Nasi">
                            <div class="card-body d-flex flex-column">
                                <h5 class="card-title">Program at Barangay Nasi</h5>
                                <p class="card-text text-muted">Rosario, Batangas — August 8, 2025</p>
                                <p class="card-text text-muted">The Provincial Health Office and other NGAs provided
                                    medical
                                    and dental services during the RCSP activity.</p>
                                <div class="mt-auto">
                                    <button class="btn btn-download w-100 download-btn" data-file="14.pdf">
                                        <i class="fa fa-download me-2"></i>Download
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-6 col-lg-4 pcr-item" data-date="2025-08-22"
                        data-title="Program at Barangay Palakpak Rosario Batangas">
                        <div class="card shadow h-100 border-0">
                            <img src="img/activities/15.png" class="card-img-top" alt="Barangay Palakpak">
                            <div class="card-body d-flex flex-column">
                                <h5 class="card-title">Program at Barangay Palakpak</h5>
                                <p class="card-text text-muted">Rosario, Batangas — August 22, 2025</p>
                                <p class="card-text text-muted">The Provincial Health Office and other NGAs provided
                                    medical
                                    and dental services during the RCSP activity.</p>
                                <div class="mt-auto">
                                    <button class="btn btn-download w-100 download-btn" data-file="15.pdf">
                                        <i class="fa fa-download me-2"></i>Download
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-6 col-lg-4 pcr-item" data-date="2025-07-25"
                        data-title="Program at Barangay Piña Taysan Batangas">
                        <div class="card shadow h-100 border-0">
                            <img src="img/activities/16.png" class="card-img-top" alt="Barangay Piña">
                            <div class="card-body d-flex flex-column">
                                <h5 class="card-title">Program at Barangay Piña</h5>
                                <p class="card-text text-muted">Taysan, Batangas — July 25, 2025</p>
                                <p class="card-text text-muted">The 1st Batangas PMFC and 59th Infantry (Protector)
                                    Battalion, Philippine Army, offered free haircuts during the RCSP activity.</p>
                                <div class="mt-auto">
                                    <button class="btn btn-download w-100 download-btn" data-file="16.pdf">
                                        <i class="fa fa-download me-2"></i>Download
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-6 col-lg-4 pcr-item" data-date="2025-07-31"
                        data-title="Program at Barangay Pinagbayanan Taysan Batangas">
                        <div class="card shadow h-100 border-0">
                            <img src="img/activities/17.png" class="card-img-top" alt="Barangay Pinagbayanan">
                            <div class="card-body d-flex flex-column">
                                <h5 class="card-title">Program at Barangay Pinagbayanan</h5>
                                <p class="card-text text-muted">Taysan, Batangas — July 31, 2025</p>
                                <p class="card-text text-muted">The 1st Batangas PMFC, 59th Infantry (Protector)
                                    Battalion,
                                    Philippine Army, together with members of the Women’s Sector and LGBTQ, offered free
                                    haircuts, manicures, pedicures, and massages during the RCSP activity.</p>
                                <div class="mt-auto">
                                    <button class="btn btn-download w-100 download-btn" data-file="17.pdf">
                                        <i class="fa fa-download me-2"></i>Download
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-6 col-lg-4 pcr-item" data-date="2025-09-12"
                        data-title="Program at Barangay Pinaghawanan Rosario Batangas">
                        <div class="card shadow h-100 border-0">
                            <img src="img/activities/18.png" class="card-img-top" alt="Barangay Pinaghawanan">
                            <div class="card-body d-flex flex-column">
                                <h5 class="card-title">Program at Barangay Pinaghawanan</h5>
                                <p class="card-text text-muted">Rosario, Batangas — September 12, 2025</p>
                                <p class="card-text text-muted">The 1st Batangas PMFC and 59th Infantry (Protector)
                                    Battalion, Philippine Army, offered free haircuts during the RCSP activity.</p>
                                <div class="mt-auto">
                                    <button class="btn btn-download w-100 download-btn" data-file="18.pdf">
                                        <i class="fa fa-download me-2"></i>Download
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-6 col-lg-4 pcr-item" data-date="2025-08-09"
                        data-title="Program at Barangay Sampiro San Juan Batangas">
                        <div class="card shadow h-100 border-0">
                            <img src="img/activities/19.png" class="card-img-top" alt="Barangay Sampiro">
                            <div class="card-body d-flex flex-column">
                                <h5 class="card-title">Program at Barangay Sampiro</h5>
                                <p class="card-text text-muted">San Juan, Batangas — August 9, 2025</p>
                                <p class="card-text text-muted">The 1st Batangas PMFC and 59th Infantry (Protector)
                                    Battalion, Philippine Army, offered free haircuts during the RCSP activity.</p>
                                <div class="mt-auto">
                                    <button class="btn btn-download w-100 download-btn" data-file="19.pdf">
                                        <i class="fa fa-download me-2"></i>Download
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
                <div class="text-center mt-4">
                    <button id="showMoreBtn" class="btn btn-outline-primary px-4">Show More Activities</button>
                </div>
            </div>
        </div>

    </div>
    <div id="footer"></div>

    <!-- JavaScript Libraries -->
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="lib/wow/wow.min.js"></script>
    <script src="lib/easing/easing.min.js"></script>
    <script src="lib/waypoints/waypoints.min.js"></script>
    <script src="lib/owlcarousel/owl.carousel.min.js"></script>
    <script src="lib/counterup/counterup.min.js"></script>

    <!-- Template Javascript -->
    <script src="js/main.js"></script>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const searchInput = document.getElementById("searchPCR");
            const startDate = document.getElementById("startDate");
            const endDate = document.getElementById("endDate");
            const sortBtn = document.getElementById("sortBtn");
            const activitiesContainer = document.getElementById("pcrActivities");
            const items = document.querySelectorAll(".pcr-item");
            const showMoreBtn = document.getElementById("showMoreBtn");

            function filterAndSortActivities() {
                const searchText = searchInput.value.toLowerCase();
                const start = startDate.value ? new Date(startDate.value) : null;
                const end = endDate.value ? new Date(endDate.value) : null;
                const sortOrder = sortBtn.getAttribute("data-sort");

                const filteredItems = Array.from(items).filter(item => {
                    const textContent = item.innerText.toLowerCase();
                    const itemDate = new Date(item.getAttribute("data-date"));

                    const matchesSearch = textContent.includes(searchText);
                    const matchesDate = (!start || itemDate >= start) && (!end || itemDate <= end);

                    return matchesSearch && matchesDate;
                });

                filteredItems.sort((a, b) => {
                    const dateA = new Date(a.getAttribute("data-date"));
                    const dateB = new Date(b.getAttribute("data-date"));

                    if (sortOrder === "latest") {
                        return dateB - dateA;
                    } else {
                        return dateA - dateB;
                    }
                });

                activitiesContainer.innerHTML = '';
                filteredItems.forEach(item => {
                    item.style.display = "block";
                    activitiesContainer.appendChild(item);
                });
            }

            // Event Listeners
            searchInput.addEventListener("input", filterAndSortActivities);
            startDate.addEventListener("change", filterAndSortActivities);
            endDate.addEventListener("change", filterAndSortActivities);

            sortBtn.addEventListener("click", function () {
                const currentSort = this.getAttribute("data-sort");
                if (currentSort === "latest") {
                    this.setAttribute("data-sort", "oldest");
                    this.innerHTML = '<i class="fas fa-sort-amount-up me-2"></i>Sort by Oldest';
                } else {
                    this.setAttribute("data-sort", "latest");
                    this.innerHTML = '<i class="fas fa-sort-amount-down me-2"></i>Sort by Latest';
                }
                filterAndSortActivities();
            });

            // Initial page load and setup
            filterAndSortActivities(); // Call the function here to sort initially

            // Load Header and Footer
            fetch("header.html")
                .then(res => res.text())
                .then(data => document.getElementById("header").innerHTML = data);

            fetch("footer.html")
                .then(res => res.text())
                .then(data => document.getElementById("footer").innerHTML = data);

            // Show More Activities logic
            items.forEach((item, index) => {
                if (index >= 6) {
                    item.classList.add("d-none");
                }
            });

            showMoreBtn.addEventListener("click", function () {
                items.forEach(item => item.classList.remove("d-none"));
                showMoreBtn.style.display = "none";
            });

            // Download button script
            document.querySelectorAll(".download-btn").forEach(btn => {
                btn.addEventListener("click", async function () {
                    const userInput = prompt("Enter passcode to download:");
                    if (userInput !== null) {
                        const filename = this.getAttribute("data-file");

                        try {
                            const response = await fetch('/api/download', {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/json'
                                },
                                body: JSON.stringify({ passcode: userInput, filename: filename })
                            });

                            if (response.ok) {
                                const blob = await response.blob();
                                const fileExtension = filename.split('.').pop();
                                const card = this.closest('.card');
                                const cardTitle = card.querySelector('.card-title').textContent.trim();
                                const newFilename = cardTitle.replace(/[^\w\s]/gi, '').replace(/\s+/g, '_') + '.' + fileExtension;

                                const a = document.createElement('a');
                                a.href = window.URL.createObjectURL(blob);
                                a.download = newFilename;
                                document.body.appendChild(a);
                                a.click();
                                document.body.removeChild(a);
                                window.URL.revokeObjectURL(a.href);

                            } else {
                                const errorData = await response.json();
                                alert(errorData.error);
                            }
                        } catch (error) {
                            alert('An error occurred. Please try again.');
                            console.error('Fetch error:', error);
                        }
                    }
                });
            });
        });
    </script>
</body>

</html>